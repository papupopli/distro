name: Create VPS

on:
  workflow_dispatch:
  repository_dispatch:
    types: [create-vps]

jobs:
  start-vps:
    runs-on: ubuntu-22.04
    timeout-minutes: 360

    steps:
      - name: â¬‡ï¸ Checkout
        uses: actions/checkout@v3

      # ğŸ§¹ FREE UP 25â€“30GB DISK (same as TWRP builder)
      - name: ğŸ§¹ Cleanup runner
        uses: rokibhasansagar/slimhub_actions@main

      # ğŸ’¾ ADD 24GB SWAP (same as TWRP builder)
      - name: ğŸ’¾ Add 24GB swap
        uses: pierotofy/set-swap-space@master
        with:
          swap-size-gb: 24

      - name: ğŸ“ Create dirs
        run: mkdir -p links .backup

      - name: ğŸ’¾ Restore backup
        run: |
          name="${{ github.event.client_payload.vps_name }}"
          if [ "${{ github.event.client_payload.backup }}" == "true" ]; then
            echo "ğŸ“¦ Restoring backup..."
            unzip ".backup/$name.zip" -d . || echo "âš ï¸ No backup to restore."
          fi
          
